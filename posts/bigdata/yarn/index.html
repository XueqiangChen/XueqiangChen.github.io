<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Yarn入门 - Aha Moment</title><meta name=Description content="软件工程师"><meta property="og:title" content="Yarn入门"><meta property="og:description" content="1. YARN 的产生和发展 Hadoop 1.0 中的 MapReduce 存在着一些不足。 扩展性差，JobTracker 既要做资源管理，又要做任务监控，job 的最大并发数受到影响。 可用性差"><meta property="og:type" content="article"><meta property="og:url" content="https://ahamoment.cn/posts/bigdata/yarn/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-16T15:35:24+08:00"><meta property="article:modified_time" content="2023-08-16T15:35:24+08:00"><meta property="og:site_name" content="Aha Moment"><meta name=twitter:card content="summary"><meta name=twitter:title content="Yarn入门"><meta name=twitter:description content="1. YARN 的产生和发展 Hadoop 1.0 中的 MapReduce 存在着一些不足。 扩展性差，JobTracker 既要做资源管理，又要做任务监控，job 的最大并发数受到影响。 可用性差"><meta name=application-name content="Aha Moment!"><meta name=apple-mobile-web-app-title content="Aha Moment!"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://ahamoment.cn/posts/bigdata/yarn/><link rel=prev href=https://ahamoment.cn/posts/bigdata/hive-hive/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Yarn入门","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/ahamoment.cn\/posts\/bigdata\/yarn\/"},"genre":"posts","keywords":"yarn, hadoop","wordcount":4369,"url":"https:\/\/ahamoment.cn\/posts\/bigdata\/yarn\/","datePublished":"2023-08-16T15:35:24+08:00","dateModified":"2023-08-16T15:35:24+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xueqiang.chen"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Aha Moment">Aha Moment!</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Aha Moment">Aha Moment!</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Yarn入门</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://ahamoment.cn title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>xueqiang.chen</a></span>&nbsp;<span class=post-category>included in <a href=/categories/bigdata/><i class="far fa-folder fa-fw" aria-hidden=true></i>bigdata</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-08-16>2023-08-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;4369 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;9 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-yarn-的产生和发展>1. YARN 的产生和发展</a></li><li><a href=#2-yarn-的组成架构>2. YARN 的组成架构</a><ul><li><a href=#21-基本工作流程>2.1 基本工作流程</a></li><li><a href=#22-yarn-container>2.2 YARN Container</a></li></ul></li><li><a href=#3-资源调度器>3. 资源调度器</a><ul><li><a href=#31-资源调度算法>3.1 资源调度算法</a></li><li><a href=#32-yarn的三种调度器>3.2 YARN的三种调度器</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=1-yarn-的产生和发展>1. YARN 的产生和发展</h2><p>Hadoop 1.0 中的 MapReduce 存在着一些不足。</p><ul><li>扩展性差，JobTracker 既要做资源管理，又要做任务监控，job 的最大并发数受到影响。</li><li>可用性差。JobTracker 存在单点故障问题。</li><li>资源利用率低。Map Slot 和 Reduce Slot 的设计无法分享，造成资源浪费。</li><li>无法支持更多计算模型。只能进行 MapReduce 计算模型，无法调度流式计算，迭代计算，DAG 计算等模型。</li></ul><p>于是在 Hadoop 2.0 中增加了 YARN 这个组件，将资源管理和作业监控分出独立的进程。</p><h2 id=2-yarn-的组成架构>2. YARN 的组成架构</h2><p>YARN 由 ResourceManager，NodeManager，ApplicationMaster 这三个组件组成。</p><p>ResourceManager 负责整个系统的资源管理和分配，负责处理客户端请求，启动/监控 ApplicationMaster，监控 NodeManage。ResourceManager 主要由调度器（Scheduler）和应用程序管理器（Applications Manager）组成。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814110747.png></p><p>NodeManager 驻留一个 YARN 集群中的每个节点上的代理，用于获取节点的资源，处理来自 RM 和 AM 的命令。</p><p>ApplicationMaster 应用程序管理器，负责系统中所有应用程序的管理工作。Application Master 实际上是特定计算框架的一个实例，每种计算框架都有自己独特的ApplicationMaster，负责与ResourceManager协商资源，并和NodeManager协同来执行和监控Container。MapReduce只是可以运行在YARN的一种计算框架。AM 的具体有以下几项功能：</p><ol><li>与 Resource Manager 协商获取资源，以容器的形式为 ApplicationMaster 分配资源。</li><li>把获得的资源进一步分配给内部的各个任务（Map 任务或 Reduce 任务）</li><li>与 NodeManager 保持交互通信，进行应用程序的启动，运行，监控和停止。</li><li>向 ResourceManager 发送“心跳”消息，报告资源的使用情况和应用的进度信息。</li><li>作业完成时，ApplicationMaster 向 ResourceManager 注销容器。</li></ol><h3 id=21-基本工作流程>2.1 基本工作流程</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814100432.png></p><p>YARN 的基本工作流程如上图所示：</p><ol><li>客户端提交作业job.waitForCompletion启动yarnRunner，yarnRunner向rm申请一个 Applicaiton。rm返回一个资源提交路径和application_id，客户端提交job所需要的资源（切片+配置信息+jar包）到资源提交路径。资源提交完毕，客户端申请运行 AppMaster。</li><li>RM 将用户请求初始化为task，放入队列。NodeManager从队列领取任务。</li><li>Node Manager 创建容器，启动 ApplicationMaster，读切片信息知道启动多少MapTask。ApplicationMaster 与 ApplicationManager 通信，汇报状态。</li><li>ApplicationMaster 请求 Resource Scheduler，申请运行MapTask容器。</li><li>NodeManager通过心跳领取到任务，创建容器，同时接受AppMaster发送来的启动脚本，启动MapTask。</li><li>Application Master 拉取配置文件和 Jar 包，分发到 NodeManager 的 Task 上。</li><li>Task 汇报运行的状态，MapTask结束后，AppMaster申请运行ReduceTask容器。</li><li>Application Master 上报任务完成的状态</li></ol><h3 id=22-yarn-container>2.2 YARN Container</h3><p>YARN Container 是逻辑上的概念，是 YARN 进行资源分配的最小单位。它和 Linux Container 没有任何关系。启动一个 YARN Container 的时候实际上是启动了一个 SHELL 进程，这个进程会拉起一个 JVM 子进程来跑具体的 Task。因此，只要加上Linux Cgroup功能，YARN Container 也能像 Linux Container 一样为任务提供一个隔离环境。</p><p>YARN 分配 Container 的过程如下：
<img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814104513.png></p><ol><li>ApplicationMaster 发送资源请求，资源调度器并不会马上就为它返回满足要求的资源。应用程序 AM 不断与 RM通信，探测分配到的资源。</li><li>AM 可从资源调度器获取以Container表示的资源，这里的Container可以看做一个可序列化Java对象，包含的字段信息：
<img class=lazyload src=/svg/loading.min.svg data-src=Pasted%20image%2020230814105742.png data-srcset="Pasted%20image%2020230814105742.png, Pasted%20image%2020230814105742.png 1.5x, Pasted%20image%2020230814105742.png 2x" data-sizes=auto alt=Pasted%20image%2020230814105742.png title=Pasted%20image%2020230814105742.png></li><li>AM 收到 Container 后，将运行在该 Container 的任务所需的运行环境信息（包含运行命令、环境变量、依赖的外部文件等）连同Container中的资源信息封装到StartContainerRequests对象中，发送给NodeManager，以启动该任务。</li></ol><h2 id=3-资源调度器>3. 资源调度器</h2><h3 id=31-资源调度算法>3.1 资源调度算法</h3><p>在讲 YARN 的资源调度器钱，我们先了解几种通用的资源调度算法。调度算法是整个资源管理系统中的一个重要组成部分，简单地说，调度算法的作用是决定一个计算任务需要放在集群中的哪台机器上面。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814111502.png></p><p><strong>1. FIFO 调度</strong></p><p>基本思路：先来的先被调用，先分配CPU、内存等资源，后来的在队列等待。<br>优点：这种方式适合平均计算时间、耗用资源情况差不多的作业，为了让后来的作业有机会提前运行，通常还会匹配优先级，即优先级高的先运行，优先级一样的按先来后到方式运行。
缺点：但是实际操作的时候，优先级容易碰到问题，如果用户都认为自己的作业优先，把自己提交的作业优先级都设置的最高，这样排在后面的作业还是要等很久才被调度，特别是前面有一个耗用资源特别久的作业，比如占用几个小时乃至几天的大部分机器的CPU和内存的训练算法作业，导致排在后面的大量很短时间运行完、耗用资源比较少的作业很久才被调度，实际上他们优先调度更适合。</p><p><strong>2.SJF调度（短任务优先：Shortest Job First，SJF）</strong></p><p>为了改进FIFO算法，减少平均周转时间，人们提出了短作业优先算法。<br>基本思路：各个任务在开始执行之前，必须事先预计好它的执行时间，然后调度器将根据这些时间，从中选择用时较短的任务优先执行。<br>优点：这种方式已经解决FIFO算法的缺点，不会让短任务因为前面出现的大任务而堆积。<br>缺点： 但是这样也是有问题的，如果一个用户一次提交了大量作业，就为了优先得到执行，如果他提交的作业时间都比较短，那永远都是这个用户在占用计算平台集群资源，其他用户永远在等。</p><p><strong>3.时间片轮转调度</strong></p><p>时间片轮转算法（Round Robin，RR）<br>基本思路是：把系统当中的所有就绪任务按照先来先服务的原则，排成一个队列，然后再每次调度的时候，把处理器分派给队列当中的第一个任务，让它去执行一小段CPU时间（即时间片，timeslice）。当这个时间片结束时，如果任务还没有执行完成的话，将会发生时钟中断，在时钟中断里面，调度器将会暂停当前任务的执行，并把它送到就绪队列的末尾，然后执行当前的队首任务。<br>反之，如果一个任务在它的时间片用完之前就已经结束了或者阻塞了，那么它就会立即让出CPU给其他任务。<br>优点： 跟任务的大小无关，大家获得公平的资源分配。<br>缺点：该算法要求计算框架支持中断。此外，时间片的大小要适当选取，如果选择不当，将会影响到系统的性能和效率。 如果时间片太大，每个任务都在一个时间片内完成，这就退化为先来先服务算法了，如果太小， 任务之间的切换次数增加，从而增大了系统的管理开销，降低了CPU的使用效率</p><p><strong>4. 最大最小公平调度</strong></p><p>最大最小公平调度（Min-Max Fair）<br>基本思路： 将资源平分成n份,每份都是S/n,把每份分给相应的用户，如果超过了用户的需求，就回收超过的部分， 然后把总体回收的资源，平均分给上一轮分配中尚未得到满足的用户，依次类 推，直到没有回收的资源为止。</p><p>加权最大最小公平调度（Weighted Min-Max Fair）<br>基本思路： 令<code>W=w1 + w2+ … + wn</code>, 将资源按照权重分成n份，每份分别是：<code>S*w1/W, S*w2/W,…, S*wn/W</code>。把每份分给相应的用户。 如果超过了用户的需求，就回收超过的部分，假设有m个用户尚未得到满足。然后把总体回收的资源，按照目前尚未满足的用户的权重分成m份，给对应的用户。依次类推，直到没有回收的资源为止。<br>优点：考虑到了公平性，无论是大任务还是小任务，都能相对公平的得到服务。<br>缺点：加权的设置对平台有着更高的要求，加权不合理可能会破坏公平性。</p><p><strong>5.容量调度</strong></p><p>容量调度（Capacity）<br>基本思路： 首先划分多个队列， 队列资源采用容量占比的方式进行分配 。 每个队列设置资源最低保证和资源使用上限。 如果队列中的资源有剩余或者空闲，可以暂时共享给那些需要资源的队列，而一旦该队列有新的应用程序需要资源运行，则其他队列释放的资源会归还给该队列。<br>优点：资源可以得到最大化的利用<br>缺点：但是小任务仍然会等待较多的时间。而且无法自定义优先级。</p><h3 id=32-yarn的三种调度器>3.2 YARN的三种调度器</h3><p>ResourceManager作为YARN的核心组件，调度器就位于其中。</p><h4 id=321-fifo-调度器>3.2.1 FIFO 调度器</h4><p>按照先进先出的规则，同一个时间队列中只有一个任务在执行。FIFO 调度器以集群资源独占的方式来运行作业，这样的好处是可以充分利用所有的集群资源。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814112756.png></p><p>如图所示，有一个很大的Job1先提交，并且占用了全部的资源。那么job2提交时发现没有资源了，则job2必须等待job1执行结束，才能获得资源执行。</p><h4 id=322-容量调度器>3.2.2 容量调度器</h4><p>容量调度器有多个队列，队列支持树形嵌套。每个队列内部可以使用FIFO先进先出，同一时间队列只有一个任务在执行。队列的并行度为队列的个数。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814113117.png></p><p>如图所示，我们可以为每个队列分配一个资源占比，队列A 60%，队列B 40%。队列A 又可以分为 A1 (40%) 和 A2 （60%），子队列中的占比是指占父队列的资源比例，即A1占A队列的40%，占根（root）队列的24%。通过配置<code>maximum-capacity</code> 可以配置队列资源使用上限百分比，这样在其他队列空闲的情况下，空闲的资源可以分配给需要的队列。通过配置 <code>user-limit-fator</code> 配置每个用户最多可使用的资源百分比。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814143837.png></p><p>如图所示，有一个大的job1提交到queueA，并占用了全部资源，queue B 中此没有任务，也会被借用。此时再提交一个小job2到queueB，因为queueA和queueB资源相互独立，job2可以使用抢占规则，把job1的占用的任务kill掉，立即执行自己的任务，也可以等job1慢慢执行完，job2再开始占用，之后的job1无法再调度资源到 queue B。</p><h4 id=323-公平调度器>3.2.3 公平调度器</h4><p>公平调度器与容量调度一样，都有层次化队列的设计，每个队列内部的作业按<strong>缺额</strong>（在资源有限的情况下，每个job理想情况下获得的资源与实际获得的资源存在一个差距，这个差距就是缺额）分配资源，同一时间队列中有多个任务执行。队列的并行度等于队列的个数。</p><p>公平调度的好处是可以让段的作业在合理的时间内完成，而不必一直等待长作业的完成，并且作业可以设置优先级。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png data-srcset="https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png 1.5x, https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png 2x" data-sizes=auto alt=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png title=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/Pasted%20image%2020230814144353.png></p><p>如图所示，先提交到队列A的job1占用了整个集群的资源，此时job2提交到队列B。原先被job2占用的队列B的资源释放，稍微延迟一会儿后，job1和job2同时运行，各占一半。此时在队列B再提交一个job3，job2和job3将同时运行，各占四份之一。</p><p>容量调度器与公平调度器的区别：</p><p>相同：</p><ol><li>以队列划分资源</li><li>设定最低保证和最大使用上限。</li><li>在某个队列空闲时可以将资源共享给其他队列。</li></ol><p>不同：</p><ol><li>公平调度器队列内支持多种调度策略，包括FIFO, Fair（队列中的N个作业，每个获得该队列1/N的资源）、DRF（多种资源类型，e.g. CPU，内存的公平资源分配策略）</li><li>公平调度器可以使得小应用快速获得资源，避免了饿死的情况。</li><li>容量调度支持更多的功能，如带label的调度，对不同资源的机器做分区。</li><li>容量调度在生产中能支持更多的任务，性能比公平调度器好。</li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-16</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-title=Yarn入门 data-via=xueqiang_chen data-hashtags=yarn,hadoop><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-hashtag=yarn><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-title=Yarn入门><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-title=Yarn入门><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-title=Yarn入门 data-image=https://chenxqblog-1258795182.cos.ap-guangzhou.myqcloud.com/obsidian/What-is-Yarn-in-Hadoop.jpg data-ralateuid=陈先森cxq><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Evernote" data-sharer=evernote data-url=https://ahamoment.cn/posts/bigdata/yarn/ data-title=Yarn入门><i class="fab fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/yarn/>yarn</a>,&nbsp;<a href=/tags/hadoop/>hadoop</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/bigdata/hive-hive/ class=prev rel=prev title=HIVE概述和HIVE基本原理><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>HIVE概述和HIVE基本原理</a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"",lightTheme:"github-light",repo:"XueqiangChen/hugo-comments"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"RCJ4GYIB7J",algoliaIndex:"ahamoment",algoliaSearchKey:"3f4bed7c2af5c9695da27d5432f662e9",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"algolia"},twemoji:!0}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>